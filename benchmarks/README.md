# Benchmarks

These are informal benchmarks comparing the performance of `modern-tar` against other popular tar libraries in Node.js. The usecase is for debugging and general reference, not for rigorous performance analysis.

## Libraries Compared

- [`modern-tar`](https://github.com/ayuhito/modern-tar)
- [`node-tar`](https://github.com/isaacs/node-tar)
- [`tar-fs`](https://github.com/mafintosh/tar-fs)

## Usage

### Setup

The benchmarks use **npm** for a pure Node environment:

```bash
cd benchmarks
npm install
```

### Running Benchmarks

```bash
# Run all benchmarks
npm run bench
```

## Recent Results

These benchmarks were run on an Apple M3 Pro and can include a lot of noise. Results should only be used to compare relative performance rather than absolute numbers.

### Packing Benchmarks

```sh
--- Many Small Files (2500 x 1KB) ---
┌─────────┬─────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                   │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼─────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Many Small Files (2500 x 1KB)' │ '225058828 ± 1.95%' │ '217920084 ± 9077375' │ '4 ± 1.86%'            │ '5 ± 0'                │ 54      │
│ 1       │ 'node-tar: Many Small Files (2500 x 1KB)'   │ '70262930 ± 1.22%'  │ '68575625 ± 2009875'  │ '14 ± 1.04%'           │ '15 ± 0'               │ 171     │
│ 2       │ 'tar-fs: Many Small Files (2500 x 1KB)'     │ '133522333 ± 0.56%' │ '132118958 ± 634521'  │ '7 ± 0.52%'            │ '8 ± 0'                │ 90      │
└─────────┴─────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Many Small Nested Files (2500 x 1KB) ---
┌─────────┬────────────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                          │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼────────────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Many Small Nested Files (2500 x 1KB)' │ '222591965 ± 0.74%' │ '220964271 ± 3586729' │ '4 ± 0.71%'            │ '5 ± 0'                │ 54      │
│ 1       │ 'node-tar: Many Small Nested Files (2500 x 1KB)'   │ '73603748 ± 0.62%'  │ '72741791 ± 898688'   │ '14 ± 0.57%'           │ '14 ± 0'               │ 164     │
│ 2       │ 'tar-fs: Many Small Nested Files (2500 x 1KB)'     │ '140871567 ± 0.71%' │ '139572958 ± 540146'  │ '7 ± 0.71%'            │ '7 ± 0'                │ 86      │
└─────────┴────────────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Few Large Files (5 x 20MB) ---
┌─────────┬──────────────────────────────────────────┬────────────────────┬─────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                │ Latency avg (ns)   │ Latency med (ns)    │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼──────────────────────────────────────────┼────────────────────┼─────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Few Large Files (5 x 20MB)' │ '28919616 ± 0.53%' │ '28621167 ± 712083' │ '35 ± 0.47%'           │ '35 ± 1'               │ 416     │
│ 1       │ 'node-tar: Few Large Files (5 x 20MB)'   │ '10037138 ± 0.50%' │ '9792479 ± 384063'  │ '100 ± 0.43%'          │ '102 ± 4'              │ 1196    │
│ 2       │ 'tar-fs: Few Large Files (5 x 20MB)'     │ '28201297 ± 0.43%' │ '28057312 ± 690000' │ '36 ± 0.40%'           │ '36 ± 1'               │ 426     │
└─────────┴──────────────────────────────────────────┴────────────────────┴─────────────────────┴────────────────────────┴────────────────────────┴─────────┘
```

### Unpacking Benchmarks

```sh
--- Unpack Many Small Files (2500 x 1KB) ---
┌─────────┬────────────────────────────────────────────────────┬─────────────────────┬────────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                          │ Latency avg (ns)    │ Latency med (ns)       │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Many Small Files (2500 x 1KB)' │ '364032696 ± 2.87%' │ '363177271 ± 21299604' │ '3 ± 2.82%'            │ '3 ± 0'                │ 34      │
│ 1       │ 'node-tar: Unpack Many Small Files (2500 x 1KB)'   │ '123997762 ± 4.41%' │ '117088584 ± 17054708' │ '8 ± 3.89%'            │ '9 ± 1'                │ 97      │
│ 2       │ 'tar-fs: Unpack Many Small Files (2500 x 1KB)'     │ '361928069 ± 3.81%' │ '348663855 ± 28342063' │ '3 ± 3.60%'            │ '3 ± 0'                │ 34      │
└─────────┴────────────────────────────────────────────────────┴─────────────────────┴────────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Unpack Many Small Nested Files (2500 x 1KB) ---
┌─────────┬───────────────────────────────────────────────────────────┬─────────────────────┬────────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                                 │ Latency avg (ns)    │ Latency med (ns)       │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼───────────────────────────────────────────────────────────┼─────────────────────┼────────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Many Small Nested Files (2500 x 1KB)' │ '358604704 ± 2.86%' │ '352948188 ± 19152417' │ '3 ± 2.66%'            │ '3 ± 0'                │ 34      │
│ 1       │ 'node-tar: Unpack Many Small Nested Files (2500 x 1KB)'   │ '258526095 ± 4.32%' │ '252665166 ± 21273958' │ '4 ± 3.77%'            │ '4 ± 0'                │ 47      │
│ 2       │ 'tar-fs: Unpack Many Small Nested Files (2500 x 1KB)'     │ '479178627 ± 2.59%' │ '476483084 ± 18999166' │ '2 ± 2.35%'            │ '2 ± 0'                │ 26      │
└─────────┴───────────────────────────────────────────────────────────┴─────────────────────┴────────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Unpack Few Large Files (5 x 20MB) ---
┌─────────┬─────────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                       │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼─────────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Few Large Files (5 x 20MB)' │ '51306573 ± 4.20%'  │ '46129167 ± 1837938'  │ '21 ± 2.27%'           │ '22 ± 1'               │ 234     │
│ 1       │ 'node-tar: Unpack Few Large Files (5 x 20MB)'   │ '52658369 ± 17.83%' │ '27568875 ± 3077729'  │ '31 ± 4.56%'           │ '36 ± 4'               │ 228     │
│ 2       │ 'tar-fs: Unpack Few Large Files (5 x 20MB)'     │ '85856416 ± 16.19%' │ '70872250 ± 24566333' │ '18 ± 8.78%'           │ '14 ± 5'               │ 142     │
└─────────┴─────────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘
```

`modern-tar` is expected to be slower than alternatives due to its focus on zero dependencies, but there is still plenty of room to improve performance.
