# Benchmarks

These are informal benchmarks comparing the performance of `modern-tar` against other popular tar libraries in Node.js. The usecase is for debugging and general reference, not for rigorous performance analysis.

## Libraries Compared

- [`modern-tar`](https://github.com/ayuhito/modern-tar)
- [`node-tar`](https://github.com/isaacs/node-tar)
- [`tar-fs`](https://github.com/mafintosh/tar-fs)

## Usage

### Setup

The benchmarks use **npm** for a pure Node environment:

```bash
cd benchmarks
npm install
```

### Running Benchmarks

```bash
# Run all benchmarks
npm run bench
```

## Recent Results

These benchmarks were run on an Apple M3 Pro and can include a lot of noise. Results should only be used to compare relative performance rather than absolute numbers.

### Packing Benchmarks

```sh
--- Many Small Files (2500 x 1KB) ---
┌─────────┬─────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                   │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼─────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Many Small Files (2500 x 1KB)' │ '207698359 ± 1.46%' │ '204126959 ± 5517397' │ '5 ± 1.35%'            │ '5 ± 0'                │ 58      │
│ 1       │ 'node-tar: Many Small Files (2500 x 1KB)'   │ '70438960 ± 1.41%'  │ '67965458 ± 1169000'  │ '14 ± 1.12%'           │ '15 ± 0'               │ 171     │
│ 2       │ 'tar-fs: Many Small Files (2500 x 1KB)'     │ '131929114 ± 0.47%' │ '130642625 ± 605541'  │ '8 ± 0.45%'            │ '8 ± 0'                │ 91      │
└─────────┴─────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Many Small Nested Files (2500 x 1KB) ---
┌─────────┬────────────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                          │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼────────────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Many Small Nested Files (2500 x 1KB)' │ '217300698 ± 1.13%' │ '215844021 ± 5740562' │ '5 ± 1.10%'            │ '5 ± 0'                │ 56      │
│ 1       │ 'node-tar: Many Small Nested Files (2500 x 1KB)'   │ '72423061 ± 0.58%'  │ '71663980 ± 658584'   │ '14 ± 0.54%'           │ '14 ± 0'               │ 166     │
│ 2       │ 'tar-fs: Many Small Nested Files (2500 x 1KB)'     │ '140266103 ± 0.67%' │ '138339896 ± 1230750' │ '7 ± 0.65%'            │ '7 ± 0'                │ 86      │
└─────────┴────────────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Few Large Files (5 x 20MB) ---
┌─────────┬──────────────────────────────────────────┬────────────────────┬─────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                │ Latency avg (ns)   │ Latency med (ns)    │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼──────────────────────────────────────────┼────────────────────┼─────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Few Large Files (5 x 20MB)' │ '27377181 ± 0.36%' │ '27198292 ± 651000' │ '37 ± 0.35%'           │ '37 ± 1'               │ 439     │
│ 1       │ 'node-tar: Few Large Files (5 x 20MB)'   │ '9604781 ± 0.29%'  │ '9475709 ± 236771'  │ '104 ± 0.27%'          │ '106 ± 3'              │ 1250    │
│ 2       │ 'tar-fs: Few Large Files (5 x 20MB)'     │ '26897456 ± 0.56%' │ '26545084 ± 720251' │ '37 ± 0.51%'           │ '38 ± 1'               │ 447     │
└─────────┴──────────────────────────────────────────┴────────────────────┴─────────────────────┴────────────────────────┴────────────────────────┴─────────┘
```

### Unpacking Benchmarks

```sh
--- Unpack Many Small Files (2500 x 1KB) ---
┌─────────┬────────────────────────────────────────────────────┬─────────────────────┬────────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                          │ Latency avg (ns)    │ Latency med (ns)       │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Many Small Files (2500 x 1KB)' │ '317303332 ± 1.92%' │ '313315104 ± 13690000' │ '3 ± 1.86%'            │ '3 ± 0'                │ 38      │
│ 1       │ 'node-tar: Unpack Many Small Files (2500 x 1KB)'   │ '107691962 ± 2.17%' │ '103067604 ± 4738083'  │ '9 ± 1.91%'            │ '10 ± 0'               │ 112     │
│ 2       │ 'tar-fs: Unpack Many Small Files (2500 x 1KB)'     │ '325268230 ± 3.22%' │ '310930875 ± 14911625' │ '3 ± 2.85%'            │ '3 ± 0'                │ 37      │
└─────────┴────────────────────────────────────────────────────┴─────────────────────┴────────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Unpack Many Small Nested Files (2500 x 1KB) ---
┌─────────┬───────────────────────────────────────────────────────────┬─────────────────────┬────────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                                 │ Latency avg (ns)    │ Latency med (ns)       │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼───────────────────────────────────────────────────────────┼─────────────────────┼────────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Many Small Nested Files (2500 x 1KB)' │ '316526738 ± 2.35%' │ '317464646 ± 17767562' │ '3 ± 2.25%'            │ '3 ± 0'                │ 38      │
│ 1       │ 'node-tar: Unpack Many Small Nested Files (2500 x 1KB)'   │ '245275303 ± 3.79%' │ '243179584 ± 25218208' │ '4 ± 3.68%'            │ '4 ± 0'                │ 49      │
│ 2       │ 'tar-fs: Unpack Many Small Nested Files (2500 x 1KB)'     │ '446822059 ± 3.37%' │ '444460125 ± 20510917' │ '2 ± 3.16%'            │ '2 ± 0'                │ 27      │
└─────────┴───────────────────────────────────────────────────────────┴─────────────────────┴────────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Unpack Few Large Files (5 x 20MB) ---
┌─────────┬─────────────────────────────────────────────────┬─────────────────────┬──────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                       │ Latency avg (ns)    │ Latency med (ns)     │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼─────────────────────────────────────────────────┼─────────────────────┼──────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Few Large Files (5 x 20MB)' │ '49738877 ± 5.18%'  │ '45301041 ± 2600208' │ '21 ± 2.20%'           │ '22 ± 1'               │ 242     │
│ 1       │ 'node-tar: Unpack Few Large Files (5 x 20MB)'   │ '42019729 ± 10.73%' │ '31309542 ± 5421458' │ '31 ± 3.39%'           │ '32 ± 6'               │ 293     │
│ 2       │ 'tar-fs: Unpack Few Large Files (5 x 20MB)'     │ '43237422 ± 9.04%'  │ '35185541 ± 2555896' │ '27 ± 2.74%'           │ '28 ± 2'               │ 278     │
└─────────┴─────────────────────────────────────────────────┴─────────────────────┴──────────────────────┴────────────────────────┴────────────────────────┴─────────┘
```

`modern-tar` is expected to be slower than alternatives due to its focus on zero dependencies, but there is still plenty of room to improve performance.
